# 04 发布与回滚

## 1. 发布信息

- 版本号：待定（建议小版本）
- 发布窗口：2026-02-23 20:00 ~ 22:00（建议）
- 发布负责人：待定

## 2. 发布前检查

- [ ] 代码合并完成并通过 CI（lint/typecheck/test）
- [ ] free-globe 开关可动态开启/关闭
- [ ] Globe 关键用例与回归用例执行完毕
- [ ] 性能对比报告已归档
- [ ] 回滚脚本、回滚流程已演练
- [ ] 文档 `00~05` 与 `INDEX` 状态同步

## 3. 灰度策略

- Phase 1：内部环境全量开启（研发/QA）
- Phase 2：外部流量 10% 开启 free 模式
- Phase 3：外部流量 50% 开启，持续观察
- Phase 4：全量开启（或保持配置化按租户启用）

灰度门禁：

- 任一阶段出现 P1 问题立即停止放量；
- 指标连续 30 分钟异常则自动降级到 legacy。

## 4. 监控指标

- 交互异常率（move/rotate 相关报错）
- 关键事件序列完整率（start -> update -> end）
- 前端卡顿指标（长任务、帧率）
- Globe 模式用户停留时长与操作成功率
- `globepolecross` 触发计数与异常占比（若事件上线）

## 5. 异常处置

- 级别 P0/P1：立即关闭 free 开关，切回 legacy；
- 级别 P2：先限流灰度比例，定位后决定是否回滚；
- 所有异常均记录到本变更包 `03` 与 `04` 文档。

## 6. 回滚方案

### 6.1 触发条件

- 跨极旋转出现不可恢复的相机跳变；
- 回归缺陷影响核心地图交互；
- 性能指标超阈值并持续 30 分钟。

### 6.2 回滚步骤

1. 配置中心将 `globeRotationMode` 设置为 `legacy`；
2. 确认线上新会话已生效；
3. 对核心页面进行冒烟验证（Globe/Mercator）；
4. 若配置降级无效，执行代码版本回滚；
5. 生成事故记录并进入复盘。

### 6.3 回滚后验证

- Globe 与 Mercator 基础交互恢复正常；
- 错误率与卡顿指标回落到基线范围；
- 业务侧反馈无新增阻断问题。

## 7. 发布结果记录

- 发布开始时间：待填写
- 发布结束时间：待填写
- 灰度比例轨迹：待填写
- 结果结论：待填写

## 8. 复盘结论

- 是否达到预期：待填写
- 关键收益：待填写
- 未解决问题：待填写
- 后续行动项：待填写
