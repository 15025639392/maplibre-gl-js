# 00 变更摘要

## 1. 标题

瓦片坐标系兼容能力建设（GCJ02 / BD09）

## 2. 背景

现有地图内核默认以 WGS84 / WebMercator 语义运行。当接入高德、百度等使用 GCJ02/BD09 体系的瓦片或数据时，会出现以下问题：

- 底图与业务要素（Marker/轨迹/GeoJSON）存在系统性偏移；
- 多源叠加时图层对不齐，影响定位、测距与可视化分析；
- 业务侧只能在接入层做临时偏移补丁，重复开发且误差不可控。

## 3. 目标

- 提供统一的坐标系转换能力，支持 WGS84、GCJ02、BD09；
- 支持按数据源配置坐标体系，解决“底图坐标系与业务数据坐标系不一致”问题；
- 保障现有 WGS84 场景零破坏，具备灰度和快速回滚能力；
- 形成可扩展框架，为后续 EPSG:4490 等坐标体系扩展预留接口。

## 4. 范围

### 4.1 In Scope

- 新增坐标转换基础模块（WGS84 <-> GCJ02 <-> BD09）；
- 新增按 Source 维度的坐标系配置与运行时状态管理；
- Raster 瓦片链路优先接入（请求与显示一致性）；
- 提供调试/验收工具与测试基线（典型城市点位对齐误差验证）；
- 完成发布、灰度、回滚方案与文档回写。

### 4.2 Out of Scope

- 全量重写投影系统（不改 `projection` 主模型）；
- 三维地形/天空等高级渲染链路的坐标体系重构；
- 非常规加密坐标系（含私有偏移算法）适配；
- 对外法律合规审查流程本身（仅保留技术风险提示）。

## 5. 影响面

- 核心模块：`src/geo`（新增坐标转换与适配器）；
- Source 链路：`src/source/*`（source 运行时配置、tile 请求映射）；
- Map API 层：`src/ui/map.ts`（坐标系配置接口）；
- 测试资产：unit / integration / benchmark 用例扩展；
- 文档体系：接口规范、性能方案、发布策略与风险清单。

## 6. 风险等级

中高（Medium-High）

- 原因：跨模块影响（source、渲染、交互、API），且涉及空间坐标精度问题。

## 7. 预期收益

- 消除常见 GCJ02/BD09 叠图偏移，显著提升业务可用性；
- 降低业务侧重复“纠偏”代码与接入成本；
- 提升地图平台对国内数据源生态的兼容能力；
- 为后续多坐标系能力（含插件化扩展）打下基础。

## 8. 关联任务/Issue/PR

- 需求单：`MAP-CRS-001`（待创建）
- 技术方案评审：`ADR-tile-crs-adapter`（待创建）
- 开发 PR：待创建
