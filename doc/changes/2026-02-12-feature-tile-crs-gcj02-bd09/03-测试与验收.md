# 03 测试与验收

## 1. 测试范围（Raster Only）

- 坐标转换算法正确性与精度（WGS84/GCJ02/BD09）
- Raster source CRS 配置读写与生效验证
- Raster 瓦片显示对齐与多源叠加一致性验证
- 兼容回归（未配置 CRS 与非 Raster source 行为）
- 性能与稳定性验证（请求耗时、帧率、缓存占用）

## 2. 复现步骤（Bug 场景可填）

历史问题复现（基线）：

1. 使用 WGS84 业务点位 + GCJ02/BD09 Raster 底图；
2. 观察道路/POI 与业务点位存在整体偏移；
3. 缩放、拖拽后偏移持续存在；
4. 启用 Raster CRS 适配后应在验收阈值内对齐。

## 3. 用例设计

### 3.1 功能用例（Raster）

- C-FUNC-01：`wgs84 -> gcj02 -> wgs84` 往返精度验证
- C-FUNC-02：`gcj02 <-> bd09` 往返精度验证
- C-FUNC-03：`setRasterSourceCoordSystem` 后 Raster source 生效
- C-FUNC-04：`getRasterSourceCoordSystem` 返回与配置一致
- C-FUNC-05：未配置 Raster CRS 时行为与旧版本一致

### 3.2 回归用例（首期边界）

- C-REG-01：普通 WGS84 Raster 场景渲染无变化
- C-REG-02：Marker/Popup 常规交互无回归
- C-REG-03：多 Raster source 同时加载下渲染与缓存正常
- C-REG-04：对非 Raster source 调用 Raster API 返回预期错误

### 3.3 边界与异常用例

- C-BND-01：中国境外点位默认不执行 GCJ/BD 偏移
- C-BND-02：运行时切换同一 Raster source CRS 的一致性
- C-BND-03：非法 CRS 参数与不存在 sourceId 的容错
- C-BND-04：高频缩放/拖拽下连续请求稳定性

## 4. 执行记录

| 用例ID | 描述 | 结果 | 备注 |
| --- | --- | --- | --- |
| C-FUNC-01 | 往返转换精度验证 | pending | 实现后执行 |
| C-FUNC-03 | Raster CRS 配置生效 | pending | 实现后执行 |
| C-FUNC-05 | 兼容行为验证 | pending | 实现后执行 |
| C-REG-04 | 非 Raster API 错误语义验证 | pending | 实现后执行 |
| C-BND-01 | 境外偏移边界验证 | pending | 实现后执行 |

## 5. 性能验证（Raster Only）

目标阈值（相对 baseline）：

- Raster 请求链路中 CRS 转换耗时：P95 <= 1ms/帧批次
- 渲染主循环耗时：P95 增幅 <= 2%
- 瓦片请求成功率：不低于基线（允许波动 <= 0.2pp）
- 内存峰值：增幅 <= 5%

精度验收阈值（建议）：

- 城市场景主要校准点位对齐误差 <= 15m
- 核心业务校准点位误差 <= 8m

## 6. 验收结论

当前状态：待实现，未验收。

验收通过标准：

- Raster-only 功能、回归、边界用例全部通过
- 精度阈值与性能阈值均达标
- 未配置 CRS 与非 Raster source 兼容性验证通过
- 开关降级与版本回滚演练通过

## 7. 遗留问题

- `raster-dem` 是否并入首期由评审最终确认
- Vector/GeoJSON CRS 适配纳入二期，不在本次验收范围
- 第三方私有坐标体系插件化扩展后续评估
