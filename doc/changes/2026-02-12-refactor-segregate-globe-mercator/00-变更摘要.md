# 00 变更摘要

## 1. 标题

Globe 与 Mercator 投影彻底分离重构（segregate-globe-mercator）

## 2. 背景

当前架构中，`projection: 'globe'` 并非始终使用纯 Globe 渲染链路，而是会在特定缩放区间内部过渡到 Mercator。这会造成以下问题：

- 语义不一致：业务层认为是 Globe，内核却可能走 Mercator；
- 行为不稳定：交互、事件、视觉表现会在临界缩放附近出现切换差异；
- 扩展困难：涉及 Globe 专项能力时，需要额外兼容内部混合状态；
- 维护成本高：调试和回归测试必须覆盖隐式过渡分支。

## 3. 目标

- 明确一一映射：设置 Globe 就永远走 Globe，设置 Mercator 就永远走 Mercator；
- 去除 Globe 与 Mercator 的内部自动切换逻辑；
- 统一投影语义、事件语义与测试口径；
- 在不破坏存量 API 的前提下完成重构并支持灰度回滚。

## 4. 范围

### 4.1 In Scope

- 投影创建工厂、Projection/Transform/CameraHelper 绑定关系重构；
- 移除 Globe 内部过渡到 Mercator 的运行时状态依赖；
- 调整事件与文档，保证投影切换仅由显式 `setProjection` 驱动；
- 补充单测、集成回归、性能对比与发布策略。

### 4.2 Out of Scope

- 新增第三种投影模式或飞行相机体系；
- 修改样式规范字段结构；
- 业务侧 UI 交互改版；
- 数据源与瓦片生产链路改造。

## 5. 影响面

- 投影工厂：`src/geo/projection/projection_factory.ts`
- Globe 相关：`src/geo/projection/globe_projection.ts`、`src/geo/projection/globe_transform.ts`、`src/geo/projection/globe_camera_helper.ts`
- Map 渲染主循环与事件：`src/ui/map.ts`、`src/ui/events.ts`
- 样式投影设置：`src/style/style.ts`
- 相关测试：projection、map、camera、interaction 测试集合

## 6. 风险等级

高（High）

- 原因：涉及投影主干链路，可能影响渲染、交互、事件和性能。

## 7. 预期收益

- 投影语义清晰，业务侧心智成本显著降低；
- 代码路径更直观，调试和回归范围可控；
- 便于后续分别演进 Globe 与 Mercator，而非在混合态里迭代；
- 为跨极交互、性能专项等后续改造提供稳定底座。

## 8. 关联任务/Issue/PR

- 需求单：`SEG-PROJ-001`（待创建）
- 架构评审：`ADR-projection-segregation`（待创建）
- 开发 PR：待创建
