# 04 发布与回滚

## 1. 发布信息

- 版本号：待定（建议小版本）
- 发布窗口：2026-02-20 20:00 至 22:00（建议）
- 发布负责人：待定

## 2. 发布前检查

- [ ] strict 模式实现完成并通过代码评审
- [ ] legacy-hybrid 回滚路径可用
- [ ] 功能、回归、性能测试完成且结论达标
- [ ] 配置中心开关已接入并验证
- [ ] 发布与回滚手册完成演练
- [ ] 变更文档与 `INDEX` 同步

## 3. 灰度策略

- Phase 1：内部环境开启 strict（开发/QA）
- Phase 2：线上 10% 流量开启 strict
- Phase 3：线上 50% 流量开启 strict
- Phase 4：全量 strict（保留 legacy-hybrid 兜底一周期）

灰度门禁：

- 任何阶段出现 P1 问题立即停止放量
- 关键性能指标持续 30 分钟异常则自动降级

## 4. 监控指标

- 投影配置与运行时投影一致率
- `setProjection` 相关错误率
- 渲染帧率与长任务占比
- 交互异常率（缩放、拖拽、旋转）
- WebGL context 恢复后异常率

## 5. 异常处置

- P0/P1：立即切回 legacy-hybrid 并冻结放量
- P2：降级灰度比例并并行定位
- 所有异常记录回填到 `03-测试与验收.md` 与本文件

## 6. 回滚方案

### 6.1 触发条件

- strict 模式下出现投影链路不一致
- 投影切换导致核心交互不可用
- 性能/稳定性指标持续超阈值

### 6.2 回滚步骤

1. 配置中心将 `segregationMode` 调整为 `legacy-hybrid`
2. 验证线上新会话生效
3. 冒烟验证 globe 与 mercator 基础能力
4. 若配置回滚无效，执行版本回滚
5. 生成事故记录并进入复盘

### 6.3 回滚后验证

- 线上错误率恢复到基线
- 投影相关交互恢复稳定
- 关键业务页面渲染与交互正常

## 7. 发布结果记录

- 发布开始时间：待填写
- 发布结束时间：待填写
- 灰度进度：待填写
- 发布结论：待填写

## 8. 复盘结论

- 达成情况：待填写
- 关键收益：待填写
- 发现问题：待填写
- 后续动作：待填写
