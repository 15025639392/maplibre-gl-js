# 04 技术债治理计划

## 1. 治理目标

- 将技术债治理从“临时修补”变成“持续工程能力”；
- 保证二次开发迭代过程中，质量基线只升不降；
- 为架构演进提供可控、可回滚的改造节奏。

## 2. 技术债分类

### 2.1 结构债

- 核心类职责过载（超大文件、跨域职责）。
- 模块边界不清，跨层导入较多。

### 2.2 类型债

- `any` 使用较多；
- 严格模式未全面启用。

### 2.3 测试债

- 本地与 CI 运行环境不一致；
- 某些关键场景缺少稳定回归集。

### 2.4 文档债

- 架构文档不完整；
- 接口契约未形成统一规范。

## 3. 优先级 Backlog（示例）

| 优先级 | 项目 | 目标 | 预计投入 | 验收方式 |
| --- | --- | --- | --- | --- |
| P0 | 本地质量基线修复 | lint/typecheck/unit 可稳定运行 | 3~5 天 | CI 与本地一致通过 |
| P0 | 运行环境统一 | Node/npm 版本统一，脚本固化 | 1~2 天 | 新成员可一键跑通 |
| P1 | 核心模块解耦首批 | 抽离 Runtime 与 Data 契约 | 1~2 周 | 关键回归通过 |
| P1 | 类型收敛第一轮 | 核心路径减少高风险 `any` | 1~2 周 | 类型告警下降 |
| P2 | 架构文档补齐 | 代码-文档一致 | 持续 | 评审通过 |

## 4. TypeScript 严格化迁移策略

### 阶段 1：可观测

- 建立 `any` 统计与趋势图；
- 新代码禁止新增隐式 `any`。

### 阶段 2：分区治理

- 按模块启用更严格规则（优先 Runtime/Data/Render）；
- 每轮仅治理一个子域，避免大爆炸。

### 阶段 3：全局收敛

- 逐步开启更高严格级别；
- 通过适配层处理暂时无法收敛的历史点位。

## 5. 质量门禁建议

新增或强化以下门禁：

- `lint --max-warnings=0`
- `typecheck`（含声明文件检查）
- `unit + integration + render + build` 分层执行
- 关键路径性能回归（见 `05`）

## 6. 治理节奏建议

- 每个迭代固定预留 20% 容量做技术债；
- P0/P1 债务必须进入里程碑强约束；
- 每周进行一次债务燃尽复盘。

## 7. 指标看板

建议至少跟踪：

- `any` 总量/核心模块 `any` 占比；
- lint/typecheck 失败率；
- 单测稳定性（7 日波动）；
- 回归缺陷数（按模块）。

## 8. 关联文档

- 路线图：`07-开发路线图与里程碑.md`
- 风险管理：`08-风险清单与应对.md`
- 执行模板：`09-执行模板与验收标准.md`
